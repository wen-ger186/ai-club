<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿±ä¹éƒ¨é«˜çº§å…¨æƒç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: linear-gradient(135deg, #1e3a8a, #3b82f6); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-wrapper { display: grid; grid-template-columns: 1.1fr 1fr; max-width: 960px; width: 100%; background: #fff; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .login-brand { background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.2), transparent 40%), linear-gradient(120deg, #1e40af, #2563eb); color: #fff; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .brand-top { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .brand-top img { height: 40px; }
        .brand-title { font-size: 28px; font-weight: 800; }
        .brand-sub { font-size: 16px; opacity: 0.9; margin-top: 4px; }
        .brand-points { margin-top: 24px; display: grid; gap: 10px; }
        .brand-point { display: flex; align-items: center; gap: 8px; font-size: 14px; opacity: 0.95; }
        .login-form { padding: 40px; }
        .form-title { font-size: 22px; font-weight: 700; margin-bottom: 16px; color: #111827; }
        .form-group { margin-bottom: 16px; }
        .input-row { position: relative; }
        .input-row input { width: 100%; padding: 12px 40px 12px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
        .input-row .toggle-pass { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #6b7280; }
        .options-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .options-row a { color: #2563eb; font-size: 13px; }
        .btn-primary { width: 100%; padding: 12px; background: #2563eb; color: #fff; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }
        .links { display: flex; justify-content: space-between; margin-top: 12px; font-size: 13px; }
        .error-text { display: none; color: #ef4444; font-size: 13px; margin-top: 8px; }
        @media (max-width: 900px) { .login-wrapper { grid-template-columns: 1fr; } .login-brand { padding: 28px; } .login-form { padding: 28px; } }
    </style>
</head>
<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
<body>

    <div class="login-wrapper" id="login-section">
        <div class="login-brand">
            <div class="brand-top">
                <img src="logo.png" alt="logo">
                <div>
                    <div class="brand-title">ai-club.fun</div>
                    <div class="brand-sub">é’å°‘å¹´æœ‹å‹çš„â€œç§‘åˆ›è¡—è¶…â€</div>
                </div>
            </div>
            <div class="brand-points">
                <div class="brand-point">ğŸ’» ç¼–ç¨‹é—¯å…³</div>
                <div class="brand-point">ğŸš æ— äººæœºç©¿è¶Š</div>
                <div class="brand-point">âš”ï¸ æ ¼æ–—æœºå™¨äºº</div>
                <div class="brand-point">ğŸ§± ç»“æ„æœºå™¨äººæ‹¼è£…</div>
            </div>
        </div>
        <div class="login-form">
            <div class="form-title">ç³»ç»Ÿç™»å½•</div>
            <div class="form-group">
                <div class="input-row">
                    <input type="text" id="login-username" placeholder="è´¦å·ï¼ˆå®¶é•¿æ‰‹æœºå·æˆ–ç®¡ç†å‘˜è´¦å·ï¼‰">
                </div>
            </div>
            <div class="form-group">
                <div class="input-row">
                    <input type="password" id="login-password" placeholder="å¯†ç ">
                    <span class="toggle-pass" id="toggle-pass">æ˜¾ç¤º</span>
                </div>
            </div>
            <div class="options-row">
                <label><input type="checkbox" id="remember-me"> è®°ä½è´¦å·</label>
                <a href="join.html">æ²¡æœ‰è´¦å·ï¼Ÿå»æ³¨å†Œ</a>
            </div>
            <button id="btn-login" class="btn-primary" onclick="doLogin()">ç™»å½•</button>
            <p class="error-text" id="login-error">è´¦å·æˆ–å¯†ç é”™è¯¯</p>
            <div class="links">
                <a href="index.html">è¿”å›é¦–é¡µ</a>
                <a href="clubs/songshan.html">è¿›å…¥åˆ†éƒ¨</a>
            </div>
        </div>
    </div>

    <div class="container dashboard-container" id="dashboard-section" style="display: none;">
        
        <div class="header-row">
            <div>
                <h2 id="user-display-name" class="main-title" style="margin-bottom:5px;">æ¬¢è¿</h2>
                <div class="identity-badge" id="identity-role"></div>
            </div>
            <div>
                <button onclick="logoutAction()" class="btn-logout small-btn">é€€å‡ºç³»ç»Ÿ</button>
            </div>
        </div>

        <div id="top-admin-tools" style="display:none; background:#f0f5ff; padding:15px; border-radius:8px; margin-bottom:20px; border:1px dashed #1890ff;">
            <h4 id="admin-tools-title" style="margin:0 0 10px 0; color:#1890ff;">ğŸ›¡ï¸ ç®¡ç†æ§åˆ¶å°</h4>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <button onclick="openAddAdminModal()" class="btn-secondary small-btn" style="width:auto;">+ æ–°å¢ç®¡ç†å‘˜</button>
                <button onclick="openTransferModal()" class="btn-warning small-btn" style="width:auto;">â‡Œ ä¼šå‘˜è½¬ä¼š(æ‰¹é‡)</button>
                <button onclick="deleteBatch()" class="btn-danger small-btn" style="width:auto;">ğŸ—‘ æ‰¹é‡åˆ é™¤é€‰ä¸­</button>
            </div>
        </div>
        
        <div id="admin-panel" style="display:none;">
            <div class="panel-header">
                <h3>æ¡£æ¡ˆæ•°æ®åº“</h3>
                <div id="club-admin-btns" style="display:none;">
                    <button onclick="deleteBatch()" class="btn-danger small-btn" style="width:auto; margin-right:10px;">ğŸ—‘ æ‰¹é‡åˆ é™¤é€‰ä¸­</button>
                </div>
                <button onclick="exportSelected()" class="btn-export">ğŸ“¥ å¯¼å‡ºæŠ¥è¡¨</button>
            </div>
            
            <div class="table-wrapper">
                <table id="member-table">
                    <thead>
                        <tr>
                            <th width="30"><input type="checkbox" id="select-all" onclick="toggleSelectAll()"></th>
                            <th width="60">ç…§ç‰‡</th>
                            <th width="80">æ“ä½œ</th>
                            <th>å§“å</th>
                            <th>èº«ä»½è§’è‰²</th>
                            <th>æ€§åˆ«</th>
                            <th>æ‰‹æœºå·/è´¦å·</th>
                            <th>æ‰€å±ä¿±ä¹éƒ¨</th>
                            <th>èº«ä»½è¯å·</th> <th>å°±è¯»å­¦æ ¡</th>
                            <th>ç­çº§</th>
                            <th>å®¶é•¿å¾®ä¿¡å·</th>
                        </tr>
                    </thead>
                    <tbody id="member-list-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="profile-panel" class="profile-card" style="display:none;">
            <div class="panel-header">
                <h3 id="profile-title">æ¡£æ¡ˆè¯¦æƒ…</h3>
                <button onclick="closeDetailView()" class="btn-secondary small-btn" style="width:auto;">è¿”å›åˆ—è¡¨</button>
            </div>

            <div class="profile-layout">
                <div class="photo-section">
                    <div class="photo-preview-box">
                        <img id="p-photo-preview" src="" alt="æš‚æ— ç…§ç‰‡">
                    </div>
                    <div id="photo-upload-controls">
                        <label for="p-photo-file" class="btn-upload">ğŸ“¸ ä¸Šä¼ /æ›´æ¢ç…§ç‰‡</label>
                        <input type="file" id="p-photo-file" accept="image/*" onchange="previewImage(this)" style="display:none;">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>å§“å</label>
                        <input type="text" id="p-name">
                    </div>
                    <div class="form-group">
                        <label>æ€§åˆ«</label>
                        <select id="p-gender">
                            <option value="ç”·">ç”·</option>
                            <option value="å¥³">å¥³</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ‰‹æœºå·/è´¦å·</label>
                        <input type="text" id="p-phone">
                    </div>
                    <div class="form-group">
                        <label>ç™»å½•å¯†ç  (ä¸ºç©ºåˆ™ä¸ä¿®æ”¹)</label>
                        <input type="text" id="p-password">
                    </div>
                    <div class="form-group">
                        <label>æ‰€å±ä¿±ä¹éƒ¨</label>
                        <select id="p-club-select">
                            <option value="">è¯·é€‰æ‹©ä¿±ä¹éƒ¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>èº«ä»½è¯å· (å”¯ä¸€)</label>
                        <input type="text" id="p-idcard">
                    </div>
                    <div class="form-group">
                        <label>å°±è¯»å­¦æ ¡</label>
                        <input type="text" id="p-school">
                    </div>
                    <div class="form-group">
                        <label>ç­çº§</label>
                        <input type="text" id="p-class">
                    </div>
                    <div class="form-group">
                        <label>å®¶é•¿å¾®ä¿¡å·</label>
                        <input type="text" id="p-wechat">
                    </div>
                    <input type="hidden" id="p-role">
                </div>
            </div>

            <div class="action-buttons" style="margin-top:20px; text-align:center;">
                <button onclick="saveProfileData()" class="btn-save">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <div id="modal-add-admin" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <h3>æ–°å¢ç®¡ç†å‘˜</h3>
            <div class="form-group">
                <label>è´¦å·</label>
                <input type="text" id="new-admin-user">
            </div>
            <div class="form-group">
                <label>å¯†ç </label>
                <input type="text" id="new-admin-pass" value="123456">
            </div>
            <div class="form-group">
                <label>æ˜¾ç¤ºåç§°</label>
                <input type="text" id="new-admin-name">
            </div>
            <div class="form-group">
                <label>è§’è‰²ç±»å‹</label>
                <select id="new-admin-role" onchange="toggleClubSelect(this.value)">
                    <option value="club_admin">ä¿±ä¹éƒ¨ç®¡ç†å‘˜</option>
                    <option value="super_admin">è¶…çº§ç®¡ç†å‘˜</option>
                </select>
            </div>
            <div class="form-group" id="div-new-admin-club">
                <label>è´Ÿè´£ä¿±ä¹éƒ¨</label>
                <select id="new-admin-club">
                    <option value="">è¯·é€‰æ‹©ä¿±ä¹éƒ¨</option>
                </select>
            </div>
            <div class="modal-btns">
                <button onclick="confirmAddAdmin()" class="btn-save">ç¡®è®¤</button>
                <button onclick="closeModal('modal-add-admin')" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="modal-transfer" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <h3>ä¼šå‘˜æ‰¹é‡è½¬ä¼š</h3>
            <p>å·²é€‰ <span id="transfer-count" style="color:red;font-weight:bold;">0</span> äºº</p>
            <div class="form-group">
                <label>è½¬å…¥ç›®æ ‡ï¼š</label>
                <select id="transfer-target-club">
                    <option value="">è¯·é€‰æ‹©ä¿±ä¹éƒ¨</option>
                </select>
            </div>
            <div class="modal-btns">
                <button onclick="confirmTransfer()" class="btn-save">ç¡®è®¤</button>
                <button onclick="closeModal('modal-transfer')" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script src="logic.js"></script>
    <script>
        const u = document.getElementById('login-username');
        const p = document.getElementById('login-password');
        const t = document.getElementById('toggle-pass');
        const r = document.getElementById('remember-me');
        const saved = localStorage.getItem('rememberPhone');
        if (saved) { u.value = saved; r.checked = true; }
        t.addEventListener('click', () => { if (p.type === 'password') { p.type = 'text'; t.textContent = 'éšè—'; } else { p.type = 'password'; t.textContent = 'æ˜¾ç¤º'; } });
        document.getElementById('btn-login').addEventListener('click', () => {
            if (r.checked) localStorage.setItem('rememberPhone', u.value.trim());
            else localStorage.removeItem('rememberPhone');
        });
    </script>
</body>
</html>
